{% extends "base.html" %}

{% block content %}
<div class="col-12 min-vh-100 d-flex align-items-center justify-content-center">
    <div class="vault-container text-center p-5 rounded-3 shadow-lg" style="background-color: #1a1d24; border: 1px solid #2d3748;">
        <div class="mb-4">
            <span class="vault-icon">üõ°Ô∏è</span>
        </div>
        <h1 class="display-5 fw-bold mb-3">Founder's Vault</h1>
        <p class="text-muted mb-4">Privacy-First AI Chief of Staff | Running Locally</p>

        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="alert alert-{{ 'danger' if category == 'error' else category }} alert-dismissible fade show" role="alert">
                        {{ message }}
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <form action="{{ url_for('main.upload_file') }}" method="post" enctype="multipart/form-data" class="mt-4">

            <div class="row text-start mb-4">
                <div class="col-md-6">
                    <label class="form-label text-light small text-uppercase fw-bold">Select AI Engine</label>
                    <select name="model" class="form-select bg-dark text-light border-secondary">
                        {% for key, info in models.items() %}
                        <option value="{{ key }}" {% if info.mode == 'performance' %}class="text-info"{% endif %}>
                            {{ info.name }}
                        </option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-md-6">
                    <label class="form-label text-light small text-uppercase fw-bold">Response Depth</label>
                    <select name="answer_length" class="form-select bg-dark text-light border-secondary">
                        <option value="short" selected>‚ö° Concise (Speed / 3 Chunks)</option>
                        <option value="long">üß† Comprehensive (Deep / 10 Chunks)</option>
                    </select>
                </div>
            </div>

            <div class="mb-4">
                <label for="file" class="upload-area d-block p-5 rounded-3 border border-secondary border-dashed bg-dark cursor-pointer">
                    <div class="upload-content">
                        <span class="display-4">üìÇ</span>
                        <p class="mt-3 mb-1">Drop Documents Here</p>
                        <small class="text-muted">Supports PDF and CSV</small>
                    </div>
                    <input type="file" name="file" id="file" class="d-none" accept=".pdf,.csv" multiple required onchange="updateFilename(this)">
                </label>
                <div id="filename-display" class="mt-2 text-info"></div>
            </div>

            <button type="submit" class="btn btn-success btn-lg w-100 vault-btn">
                <span class="offline-badge me-2">‚óè</span> Secure Upload
            </button>
        </form>

        <div class="mt-4 text-muted small">
            <p>üîí Your data never leaves this machine. Powered by Ollama.</p>
        </div>
    </div>
</div>

<script>
function updateFilename(input) {
    if (input.files && input.files.length > 0) {
        if(input.files.length === 1) {
            document.getElementById('filename-display').textContent = 'Selected: ' + input.files[0].name;
        } else {
            document.getElementById('filename-display').textContent = 'Selected: ' + input.files.length + ' files';
        }
    }
}
</script>
{% endblock %}